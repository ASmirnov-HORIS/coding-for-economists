---
jupytext:
  cell_metadata_filter: -all
  formats: md:myst
  text_representation:
    extension: .md
    format_name: myst
    format_version: '0.8'
    jupytext_version: 1.5.0
kernelspec:
  display_name: 'Python 3.8.6 64-bit (''codeforecon'': conda)'
  language: python
  name: codeforecon
---

# Automating Outputs

In this chapter, you'll learn how to automate the inclusion of figures, tables, and code in your outputs. Much of what you'll see in this chapter is possible in a wide range of languages (not just Python). The first section assumes some familiarity with the $\LaTeX$ typesetting language.

## Including code outputs in documents and presentations

Let's say you're writing a paper, using $\LaTeX$, or presentation, using $\LaTeX$ and beamer. (Perhaps you'd like the final document or presentation to be in Word, Powerpoint-that's okay too, but let's assume you're *writing* it in $\LaTeX$.)

Including code outputs is pretty simple, but is slightly different for figures and tables (the two main outputs you might include).

### Figures

For figures, the $\LaTeX$ **graphicx** package is your friend as it allows you to set a directory where your figures live, for example `outputs/figures`, which would be set like this at the top of the document:

```latex
\usepackage{graphicx}
\graphicspath{{outputs/figures/}}
```

We're imagining here that we have a structure like this:

```
code.py
paper.tex
outputs/
    figures/
        chart.pdf
    tables/
        reg_table.tex
```

Then, whenever you need to include a figure, say `chart.pdf`, you can always do it using

```latex
\begin{figure}
	\includegraphics[width=\textwidth]{chart.pdf}
	\caption{Example figure. \label{fig:example}}
\end{figure}
```

Let's pretend `chart.pdf` is generated by the most popular Python graphics library, **matplotlib**. The code in 'code.py' which puts the chart in the 'figures' folder could look something like this:

```python
import matplotlib.pyplot as plt
fig, ax = plt.subplots()
ax.scatter(range(5), range(5), s=50, c='b')
plt.savefig("outputs/figures/chart.pdf")
```

The important line here is `plt.savefig("outputs/figures/chart.pdf")` because it says to save the figure in the 'figures' directory. When you re-run your code, the chart ends up in the right place. When you re-compile your $\LaTeX$ document or presentation, it can pick the chart up from the right place.

### Tables

Now let's imagine you've create a regression table, for example

```{code-cell} ipython3
import pandas as pd
from sklearn import datasets
import statsmodels.formula.api as smf
from stargazer.stargazer import Stargazer

diabetes = datasets.load_diabetes()
df = pd.DataFrame(diabetes.data)
df.columns = ['Age', 'Sex', 'BMI', 'ABP', 'S1', 'S2', 'S3', 'S4', 'S5', 'S6']
df['target'] = diabetes.target

est = smf.ols('target ~ Age + Sex + BMI + ABP', data=df).fit()
est2 = smf.ols('target ~ Age + Sex + BMI + ABP + S1 + S2', data=df).fit()

reg_results = Stargazer([est, est2])
reg_results
```

We'd like to export this into a table that can be picked up by our latex document. We must first save it to the right place from Python:

```python
with open('outputs/tables/reg_table.tex', 'w') as f:
    f.write(reg_results.render_latex())
```

This opens up a file in write mode in the right directory relative to `code.py`, and puts the latex into it. We now need to ensure that this latex gets picked up in our paper. Inside the paper, you need a line:

```latex
\input{outputs/tables/reg_table.tex}
```

which picks up your table. If you don't want to have to add the full path to the tables directory each time, you can add this near the top of 'paper.tex':

```latex
\makeatletter
\providecommand*{\input@path}{}
\g@addto@macro\input@path{{outputs/tables/}}
\makeatother
```

### Exporting to other document types

Finally, you may *not* want your final output to be a PDF (the standard output for $\LaTeX$), but to be one of a range of other document types. For this, the command line tool [**pandoc**](https://pandoc.org/) is absolutely brilliant and can translate $\LaTeX$ papers and beamer presentations into a whole variety of other formats, including Microsoft Word's .docx, OpenOffice's .ODT, Microsoft Powerpoint's .pptx, HTML, plain text, markdown, and more. See the previous chapter or the pandoc documentation for more on how to do this. We will also make use of pandoc in the next section.

## Complete automation of outputs

Sometimes, partial automation is not enough: you want everything to be run by code in a repeatable and scalable way-even the documents and presentations.

### Using Jupyter notebooks to automate code outputs in reports

Jupyter notebooks mix text and code, and the best notebook-dedicated integrated development editor (IDE) is [Jupyter Lab](https://jupyter.org/). Jupyter Lab offers a quick and simple method of fully automating reports. Once installed, to start Jupyter Lab, type `jupyter lab` in the command line and a browser window will open. Select your programming environment, for instance 'Python-codeforecon', under the notebook heading and a fresh '.ipynb' file will open up. Try adding in some text, in the markdown cells, and some code, in the code cells. You can add new cells with the '+' button, and change cell type with the dropdown (new cells default to code). To demonstrate how notebooks can be used to fully automate reports, it's a good idea to include code that produces charts and tables, so you can get a feel for how these get weaved into a final output. Once you have a demo notebook you're happy with, and you've run all the code blocks using the play button, save it.

Now, within Jupyter Lab, go to 'File->Export Notebook As...', and you'll be given several options to export the notebook into other formats. Some of the most useful are HTML, PDF, and markdown (which will include outputs such as figures). The beauty of this setup is that, if the data change, you can just re-run the entire notebook to update the code outputs. Now, one caveat to that is that you *cannot mix code and text in the same cell*. They must be in different cells. So you can't update the text automatically, only the the code outputs (we'll see an example of updating the text automatically too in the next subsection).

Jupyter Lab doesn't just offer exports to document type formats though, it can do slides too. To use this functionality, hit the the button in the left hand ribbon that has an icon that features two cogs. This opens up a window to edit the meta-data of cells. You'll see a dropdown menu with the heading 'slide type' with options:

- Slide - a standalone slide that acts as a section heading
- Sub-slide - a slide intended to sit under a section heading
- Fragment - part of a sub-slide or slide that isn't initially revealed
- Notes - notes for the speaker
- Skip - skip this slide completely

By giving each cell in your notebook one of these designations and then using 'File->Export Notebook As->Reveal.js Slides', you can create a flashy HTML slide deck that you can show in a browser window.

It is hoped that future versions of Visual Studio Code will incorporate some of these 'export as' features that currently exist in Jupyter Lab.

Using the export notebook as option produces reports that include every cell you entered. If you're sending your report on to someone who isn't interested in the code inputs, only the outputs, then that might be less than optimal. However, there is a way to do this. It's easiest on the command line. Let's say you had a report in a notebook called `report_example.ipynb`. To convert this into an output without any code inputs, you'd navigate to the same folder as the notebook in the command line and run:

```bash
jupyter nbconvert --to html --no-input Example.ipynb
```

to convert it to a HTML file, or substitute `--to pdf` to get a PDF file out (etc). This method can also be used to create slides that do not have the code inputs.

### Using codebraid to automate code outputs (including within text)

- outputs can include word docs, pdfs (papers and beamer pres), powerpoint, html slides, html page: anything that pandoc can do. Use codebraid.

- *Many* languages

- two examples, a document and a presentation, both with refs and mention ref doc

- use code_presentation.md and code_pres_md.sh. Run latter with ./code_pres_md.sh

- if no code, everything will still work the same

- see also:
  - more control for Word, python-docx https://python-docx.readthedocs.io/en/latest/

## Review

..